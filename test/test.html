<!DOCTYPE html>
<html>
<head>
<title>Split-Flap Tests</title>
<style>
body {
  font-family: Arial, Helvetica, sans-serif;
  font-size: 100%;
}

div { margin: 0; padding: 0 }

p { clear: both; }

h1, h2 { clear: both; }

div.flap {
  float: left;
  margin-right: 5px;
  font-size: 400%;
  color: #FFF;
  background-color: #555;
  width: 1em;
  height: 1em;
  overflow: hidden;
  border: 3px solid #222;
  border-radius: 10px 10px 0 0;
  text-align: center;
  -webkit-transform-origin: bottom;
  -moz-transform-origin: bottom;
  box-shadow: 2px 2px 2px black;
}

body.flipping div.scale-y {
  -webkit-transition-property: -webkit-transform, background-color, color;
  -webkit-transition-duration: 0.2s;
  -webkit-transition-timing-function: ease-in;
  -webkit-transform: scaleY(0);

  -moz-transition-property: -moz-transform, background-color, color;
  -moz-transition-duration: 0.2s;
  -moz-transition-timing-function: ease-in;
  -moz-transform: scaleY(0);

  background-color: #222;
  color: #888;
}

</style>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
<script type="text/javascript" src="/lib/beta/js/json2.min.js"></script>
<script type="text/javascript" src="/modernizr-1.6.min.js"></script>
<script type="text/javascript" src="/lib/beta/js/utils.js"></script>
<script type="text/javascript">
var dom = namespace.lookup('org.startpad.dom');
var format = namespace.lookup('org.startpad.format');
var doc;

function onReady() {
  doc = dom.bindIDs();

  // 2D Samples
  $('#2d div.flap').each(function(i) {
    var pct = 1.0 - 0.2 * i;
    $(this).css("-webkit-transform", "scaleY(" + pct + ")");
    $(this).css("-moz-transform", "scaleY(" + pct + ")");
});

  onFlipY();
  $(doc['scale-y-exemplar']).bind('webkitTransitionEnd transitionend', onFlipY);
}

function characterRange(range) {
  var first = range.charCodeAt(0);
  var last = range.charCodeAt(1);
  s = "";
  for (var i = first; i <= last; i++) {
    s += String.fromCharCode(i);
  }
  return s;
}

var letters = characterRange('AZ');
var numbers = characterRange('09');
var symbols = characterRange('!/') + characterRange(':@') + characterRange('[`') + '~';
var space = ' ';
var sets = [letters, numbers, symbols, space];

function letterSequence(start, end) {
  start = findPos(start);
  end = findPos(end);

  // Same set - end after start
  if (start.set == end.set && end.ich >= start.ich) {
    return start.set.slice(start.ich, end.ich + 1);
  }

  s = start.set.slice(start.ich, start.set.length);

  // Same set - end before start
  if (start.set == end.set) {
    return s + end.set.slice(0, end.ich + 1);
  }

  if (start.set != space && end.set != space) {
    s += space;
  }

  return s + end.set.slice(0, end.ich + 1);
}

function findPos(ch) {
  var i, ich;

  ch = ch.toUpperCase();
  for (i = 0; i < sets.length; i++) {
    ich = sets[i].indexOf(ch);
    if (ich != -1) {
      return {'ich': ich, 'set': sets[i]};
    }
  }
  throw Error("Invalid Flap character: " + ch);
}

var msLast;
var ySeq = '';

function onFlipY() {
  var msNow = new Date().getTime();
  var ms = msNow - msLast;
  if (ms < 20) return;
  msLast = msNow;

  console.log("transitionend: " + ms, this);
  $(doc['flip-speed']).text(format.thousands(1000/ms, 1) + " fps");

  if (ySeq == '') {
    ySeq = letterSequence('M', '9');
  }
  var ch = ySeq[0];
  $('div.scale-y').text(ch);
  ySeq = ySeq.substr(1);

  $(document.body).removeClass('flipping');
  setTimeout(function () {$(document.body).addClass('flipping');}, 1);
}

$(document).ready(onReady);
</script>
</head>
<body>
<h1>Split-Flap Experiments</h1>

<h2>A Basic Box</h2>
<div id="basic" class="flap">A</div>

<h2>2D Transform</h2>

<div id=2d>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
<div class="flap">A</div>
</div>

<h2>2D Speed Test</h2>

<div id="flip-speed"></div>

<div id="scale-y-exemplar" class="flap scale-y">A</div>
<div class="flap scale-y">A</div>
<div class="flap scale-y">A</div>
<div class="flap scale-y">A</div>
<div class="flap scale-y">A</div>
<div class="flap scale-y">A</div>

<h2>Split Box</h2>

</body>
</html>
